<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="goal.mapper.GroupMapper">
	<resultMap type="goal.vo.GroupVO" id="groupVO">
		<id property="gno" column="gno"/>
		<id property="uno" column="uno"/>
		<id property="g_name" column="g_name"/>
		<id property="g_date" column="g_date"/>
		<id property="g_intro" column="g_intro"/>
		<id property="g_cate" column="g_cate"/>
		<id property="g_open" column="g_open"/>
	</resultMap>
	<resultMap type="goal.vo.GroupJoinVO" id="groupJoinVO">
		<id property="gno" column="gno"/>
		<id property="join_msg" column="join_msg"/>
		<id property="join_date" column="join_date"/>
		<id property="userName" column="userName"/>
	</resultMap>
	<select id="selectGroupList" parameterType="goal.vo.UserVO" resultMap="groupVO">
		<![CDATA[
			SELECT * FROM GK_ALLGROUP WHERE UNO=#{uno} ORDER BY gno DESC
		]]>
	</select>
	
	<select id="allList" resultMap="groupVO">
		SELECT * FROM GK_ALLGROUP where g_open='Y' order by g_date desc
	</select>
	<select id="recentGroup" resultMap="groupVO">
		<![CDATA[
		SELECT ROWNUM, GNO FROM (SELECT * FROM GK_ALLGROUP ORDER BY GNO DESC)WHERE ROWNUM <= 1
		]]>
	</select>
	<select id="selectGroup" parameterType="int" resultMap="groupVO">
		select * from gk_allgroup where gno=#{gno}
	</select>
	<select id="selectSearchList" parameterType="String" resultMap="groupVO">
		<![CDATA[
			SELECT * FROM GK_ALLGROUP WHERE (G_NAME like '%' || #{word} || '%' or G_CATE like '%' || #{word} || '%' or G_INTRO like '%' || #{word} || '%') and g_open = 'Y'
		]]>
	</select>
	<insert id="createGroup" parameterType="goal.vo.GroupVO">
		<selectKey keyProperty="gno" resultType="int" order="BEFORE">
			select GK_ALLGROUP_SEQ.nextval from dual
		</selectKey>
		insert into
		GK_ALLGROUP(gno, uno, g_name, g_intro, g_date, g_cate,
		g_open) values
		(GK_ALLGROUP_SEQ.currval, #{uno}, #{g_name},
		#{g_intro}, sysdate, #{g_cate}, #{g_open}
		)
	</insert>
	<insert id="insertGroupFile" parameterType="goal.vo.GroupFileVO">
		insert into
		GK_GROUP_PROFILE(g_fid, g_filename, g_filepath, gno) values
		(GK_GROUPFILE_SEQ.nextval, #{g_filename}, #{g_filepath}, #{g_gno})
	</insert>
	<insert id="insertGroupJoin" parameterType="goal.vo.GroupJoinVO">
		insert into GK_GROUP_JOIN(gno, join_msg, join_date, uno) values
		(#{gno}, #{join_msg}, sysdate, #{uno})
	</insert>
	<select id="selectGroupJoin" parameterType="int" resultMap="groupJoinVO">
		select GNO, JOIN_MSG, JOIN_DATE, userName, j.uno from gk_group_join j, gk_user u where j.uno=u.uno and gno=#{gno}
	</select>
	<delete id="removeGroupJoin" parameterType="goal.vo.GroupJoinVO">
		<![CDATA[
			delete gk_group_join WHERE GNO=#{gno} and uno=#{uno}
		]]> 
	</delete>
	<delete id="removeGroup" parameterType="int">
		<![CDATA[
			delete GK_ALLGROUP WHERE GNO=#{gno}
		]]> 
	</delete>
</mapper>