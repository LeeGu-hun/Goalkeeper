<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="goal.mapper.BoardMapper">
	<resultMap type="goal.vo.BoardVO" id="boardVO">
		<id property="bno" column="bno"/>
		<id property="uno" column="uno"/>
		<id property="bo_content" column="bo_content"/>
		<id property="bo_title" column="bo_title"/>
		<id property="bo_cate" column="bo_cate"/>
		<id property="bo_group" column="bo_group"/>
		<id property="bo_date" column="bo_date"/>
		<id property="bo_fileCheck" column="bo_fileCheck"/>
		<id property="bo_fileCount" column="bo_fileCount"/>
		<collection column="bno" property="fileList" javaType="List" ofType="goal.vo.BoardFileVO" select="getFileByBno"/>
		<collection column="bno" property="reactCount" javaType="int" ofType="int" select="countReact"/>
		<collection column="bno" property="reactList" javaType="List" ofType="goal.vo.ReactVO" select="getReactByBno"/>
	</resultMap>
	<resultMap type="goal.vo.ReactVO" id="reactVO">
		<id property="react_name" column="react_name"/>
		<id property="bno" column="bno"/>
		<id property="userId" column="userId"/>
	</resultMap>
	<select id="countReact" resultType="int">
		select count(*) from gk_react_list where bno=#{bno}
	</select>
	<select id="getReplyListById" resultMap="boardVO">
		select * from GK_COMMENT
	</select>
	<select id="getFileByBno" resultType="goal.vo.BoardFileVO">
		select * from GK_FILE where bno = #{bno}
	</select>
	<select id="getReactByBno" resultMap="reactVO">
		select * from GK_react_list where bno = #{bno}
	</select>
	<select id="searchBoard" resultMap="boardVO" parameterType="goal.vo.BoardVO">
		select bo_content, userid from GK_BOARD 
		where userid like '%' || #{search_result} || '%' or bo_content like '%' || #{search_result} || '%' 
	</select>
	<insert id="insertBoard" parameterType="goal.vo.BoardVO" useGeneratedKeys="true" keyProperty="bno"  keyColumn="BNO">
		insert into
		GK_BOARD(bno, userid, bo_content, bo_date, bo_cate, bo_group, bo_filecheck, bo_fileCount) values
		(GK_board_SEQ.nextval,#{userId}, #{bo_content}, sysdate, #{bo_cate}, #{bo_group}, #{bo_fileCheck}, #{bo_fileCount})
	</insert>
	<update id="updateBoard" parameterType="goal.vo.BoardVO">
		<![CDATA[
			UPDATE GK_BOARD 
			SET bo_content=#{bo_content}, bo_date=sysdate, bo_cate=#{bo_cate}, bo_fileCount=#{bo_fileCount}
			WHERE bno=#{bno}
		]]>
	</update>
	<select id="recentBoard" resultMap="boardVO">
		<![CDATA[
		SELECT ROWNUM, BNO FROM (SELECT * FROM GK_BOARD ORDER BY BNO DESC)WHERE ROWNUM <= 1
		]]>
		</select>
		
	<select id="getBoard" parameterType="goal.vo.BoardVO" resultMap="boardVO">
  	 <![CDATA[
   	select u_id, bo_content, bo_DATE, bno, replyWriter, replyContent, replyDate from Gk_BOARD join GK_COMMENT using(bno)
     ]]>
   </select>
   <select id="findBoardbyBno" parameterType="int" resultMap="boardVO">
		select * from GK_BOARD where bno=#{bno}
	</select>
	<select id="getBoardList" resultMap="boardVO">
		select * from GK_BOARD order by bo_date desc
	</select>
	
	<select id="getGroupBoardList" resultMap="boardVO" parameterType="string">
		select * from GK_BOARD where bo_group=#{bo_group} order by bo_date desc
	</select>
	
	<select id="selectBoardList" resultMap="boardVO" parameterType="goal.vo.UserVO">
		select * from GK_BOARD where uno=#{uno} order by bno desc
	</select>
	
	<delete id="deleteBoard" parameterType="int">
			DELETE FROM GK_BOARD WHERE bno=${bno}
	</delete>
</mapper>