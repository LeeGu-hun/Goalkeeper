<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:insert="/view/fragments/header.html :: header">
</head>
<body th:insert="/view/fragments/nav.html :: fragment-nav"></body>
<body>
	<div th:replace="/view/fragments/nav.html :: fragment-nav"></div>
<body data-open="click" data-menu="vertical-menu" data-col="2-columns"
	class="vertical-layout vertical-menu 2-columns  fixed-navbar">
	<div class="app-content content container-fluid">
		<div class="content-wrapper">
			<div class="content-header row">
				<div th:insert="/view/fragments/group_nav.html :: group_nav"></div>
				<div class="content-header-left col-md-6 col-xs-12 mb-1">
					<h2 class="content-header-title">목표 상세보기</h2>
				</div>
				<div
					class="content-header-right breadcrumbs-right breadcrumbs-top col-md-6 col-xs-12">
					<div class="breadcrumb-wrapper col-xs-12">
						<ol class="breadcrumb">
							<li class="breadcrumb-item active">그룹 목표</li>
							<li class="breadcrumb-item"><a
								th:href="@{'/group_singleGoal'(gno=${gno})}">개인 목표</a></li>
							<div class="fonticon-wrap"
								style="float: right; margin-left: 30px; margin-bottom: 10px;">
								<form id="memberForm" action="/group_detail" method="get">
									<input type="hidden" name="gno" th:value="${gno}">
									<button type="submit" style="width: 56px; height: 56px;"
										onclick="location.href='/group_home'">
										<i class="icon-home" style="font-size: 40px;"></i>
									</button>
								</form>
							</div>
						</ol>
					</div>
				</div>
			</div>
			<div class="content-body">
				<!-- Basic Tables start -->
				<div class="row">
					<div class="col-xs-12">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title">메인 목표</h4>
								<a class="heading-elements-toggle"><i
									class="icon-ellipsis font-medium-3"></i></a>
								<div class="heading-elements">
									<ul class="list-inline mb-0">
										<li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
										<li><a data-action="reload"><i class="icon-reload"></i></a></li>
										<li><a data-action="expand"><i class="icon-expand2"></i></a></li>
										<li><a data-action="close"><i class="icon-cross2"></i></a></li>
									</ul>
								</div>
							</div>
							<div class="card-body collapse in">
								<div class="card-block card-dashboard"
									style="display: flex; height: 200px;" th:each="list:${goal}">
									<div style="flex: 1; width: 33.3%">
										<h3 class="text-xs-center">그룹 메인 목표</h3>
										<div
											style="height: 133px; margin-top: 54px; width: auto; vertical-align: middle; text-align: center">
											<input type="checkbox" style="display: none"
												th:value="${list.dno}" name="dno"> 
											<input type="text" style="display: inline-block; color: purple; font-size: 30px; text-align: center; border: none; background: transparent;"
												th:value="${list.goal_name}" disabled></input>
										</div>
									</div>
									<div style="flex: 1; width: 33.3%">
										<h3 class="text-xs-center">목표 수치</h3>
										<div
											style="height: 133px; margin-top: 54px; width: auto; vertical-align: middle; text-align: center">
											<input type="text"
												style="border: none; font-size: 30px; color: purple; text-align: center; background: transparent;"
												th:value="${list.goal_allcnt}" disabled></input>
										</div>
									</div>
									<div style="flex: 1; width: 33.3%">
										<h3 class="text-xs-center">달성 수치</h3>
										<div
											style="height: 133px; margin-top: 54px; width: auto; vertical-align: middle; text-align: center">
											<input type="text"
												style="border: none; font-size: 30px; color: purple; text-align: center; background: transparent;"
												th:value="${list.groupMaxData}==null ? 0 : ${list.groupMaxData}"
												disabled></input>
										</div>
									</div>
								</div>
								<div class="card-block card-dashboard">
									<button class="btn btn-success btn-min-width mr-1 mb-2"
										type="text" data-toggle="modal" data-target="#goalModal">목표
										추가</button>
									<button id="checkGoalBtn"
										class="btn btn-warning btn-min-width mr-1 mb-2" type="text">목표
										수정</button>
									<button id="checkBtn"
										class="btn btn-warning btn-min-width mr-1 mb-2" type="text">확인</button>
								</div>
							</div>
						</div>
						<div class="modal fade text-xs-left-in" id="goalModal"
							tabindex="-1" role="dialog" aria-labelledby="modal"
							style="display: none; padding-right: 17px;">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">x</span>
										</button>
										<h3 class="modal-title" id="modalTitle">
											그룹 목표 추가
											</h4>
											<div class="modal-body">
												<form id="mainGoalFrm" action="/group_mainGoal"
													method="post">
													<input type="hidden" th:value="${gno}" name="gno">
													<fieldset
														class="form-group position-relative has-icon-left mb-1">
														<input type="text"
															class="form-control form-control-lg input-lg"
															id="goal_name" placeholder="목표명" name="goal_name">
														<div class="form-control-position">
															<i class="icon-flag4"></i>
														</div>
													</fieldset>
													<fieldset
														class="form-group position-relative has-icon-left mb-1">
														<input type="text"
															class="form-control form-control-lg input-lg"
															id="goal_allcnt" placeholder="목표 수치" name="goal_allcnt">
														<div class="form-control-position">
															<i class="icon-check2"></i>
														</div>
													</fieldset>
													<fieldset id="goal_input" class="f">
														<select id="goal_down" class="form-control">
															<option value="default">입력하기</option>
															<option value="2week">2주</option>
															<option value="1month">1달</option>
															<option value="3month">3달</option>
															<option value="6month">6달</option>
															<option value="1year">1년</option>
															<option value="input_self">직접 입력하기</option>
														</select>
													</fieldset>
													<br> <input type="date" id="goal_enddate"
														class="form-control round" required
														pattern="\d{4}-\d{2}-\d{2}" name="goal_enddate">
												</form>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn grey btn-outline-secondary"
													data-dismiss="modal">취소</button>
												<button type="button" id="confirmBtn"
													class="btn grey btn-outline-primary">추가하기</button>
											</div>
									</div>
								</div>
							</div>
						</div>
						<!-- Basic Tables end -->

						<footer class="footer footer-static footer-light navbar-border">
							Shared by <i class="fa fa-love"></i><a
								href="https://bootstrapthemes.co">BootstrapThemes</a>
						</footer>

						<!-- BEGIN VENDOR JS-->
						<script src="../../app-assets/js/core/libraries/jquery.min.js"
							type="text/javascript"></script>
						<script src="../../app-assets/vendors/js/ui/tether.min.js"
							type="text/javascript"></script>
						<script src="../../app-assets/js/core/libraries/bootstrap.min.js"
							type="text/javascript"></script>
						<script
							src="../../app-assets/vendors/js/ui/perfect-scrollbar.jquery.min.js"
							type="text/javascript"></script>
						<script src="../../app-assets/vendors/js/ui/unison.min.js"
							type="text/javascript"></script>
						<script src="../../app-assets/vendors/js/ui/blockUI.min.js"
							type="text/javascript"></script>
						<script
							src="../../app-assets/vendors/js/ui/jquery.matchHeight-min.js"
							type="text/javascript"></script>
						<script src="../../app-assets/vendors/js/ui/screenfull.min.js"
							type="text/javascript"></script>
						<script src="../../app-assets/vendors/js/extensions/pace.min.js"
							type="text/javascript"></script>
						<!-- BEGIN VENDOR JS-->
						<!-- BEGIN PAGE VENDOR JS-->
						<!-- END PAGE VENDOR JS-->
						<!-- BEGIN ROBUST JS-->
						<script src="../../app-assets/js/core/app-menu.js"
							type="text/javascript"></script>
						<script src="../../app-assets/js/core/app.js"
							type="text/javascript"></script>
						<!-- END ROBUST JS-->
						<!-- BEGIN PAGE LEVEL JS-->
						<!-- END PAGE LEVEL JS-->
</body>
<script type="text/javascript">
	window.onload = function() {
		var toggle = false;
		var change = false;
		$('#checkGoalBtn')
				.click(
						function() {
							if (toggle) {
								$('input[type=checkbox]').attr('style',
										'display:none');
								$(this).html("목표 수정");
								toggle = false;
							} else {
								$('input[type=checkbox]').attr('style',
										'display:inline-block');
								$(this).html("취소");
								toggle = true;
							}
						});
		$('#checkBtn').click(function() {
			if ($('input[type="checkbox"]:checked').val() == null) {
				alert("수정할 항목을 선택하세요.");
				return false;
			}
		});
		$('#confirmBtn').click(function() {
			alert("추가가 완료되었습니다.");
			$('#mainGoalFrm').submit();
		});
		$('#goal_down').change(function(){
			var self = $('#goal_down').val();
			if(self == "2week"){
				removeInput();
				var date = getDate(0, 0, 14); 
				$('#goal_enddate').val(date);
			} else if(self == "1month"){
				removeInput();
				var date = getDate(0, 1, 0);
				$('#goal_enddate').val(date);
			} else if(self == "3month"){
				removeInput();
				var date = getDate(0, 3, 0);
				$('#goal_enddate').val(date);
			} else if(self == "6month"){
				removeInput();
				var date = getDate(0, 6, 0);
				$('#goal_enddate').val(date);
			} else if(self == "1year"){
				removeInput();
				var date = getDate(1, 0, 0);
				$('#goal_enddate').val(date);
			} else if(self == "input_self"){
				$('#goal_input').append('<p>')
				$('#goal_input').append('<input type="text" id="input_self" style="display:inline-block; width:65%;" class="form-control" placeholder="원하는 일수를 입력해주세요">');
				$('#goal_input').append('<button type="button" id="self_button" class="btn btn-success btn-min-width ml-3 display-inline-block">확인</button>');
				$('#self_button').click(function(){				
					var input_value = $('#input_self').val();
					if(input_value==""){
							alert("아무것도 입력되지 않았습니다.");
						} else{
							var date = getDate(0, 0, parseInt(input_value));
							$('#goal_enddate').val(date);
						}
					});
				change = true;
			}
		});
		function removeInput(){
			if(change){
				$('#input_self').remove();
				$('#self_button').remove();
				change = true;
			}
		}
		
		function getDate(addYear, addMonth, addDay, token){		//받은 매개변수로 날짜를 추가하는 함수
			token = token == undefined || token == null ? "-" : token;
			addYear = addYear == null ? 0 : addYear;
			addMonth = addMonth == null ? 0 : addMonth;
			addDay = addDay == null ? 0 : addDay;
			var now = new Date();
			var ry = now.getFullYear();
			var rm = now.getMonth() + 1;
			var rd = now.getDate();
			
			if(addYear != 0) { //cal year
				ry = ry + addYear;
			}
			
			if(addMonth != 0) {//cal month
				var isRun = true;
				rm = rm + addMonth;
				while (isRun == true) {
					if(rm > 12){
						ry++;
						rm = rm - 12;
					} else if(rm < 1) {
						ry--;
						rm = 12 + rm;
					}
					
					if(rm > 0 && rm < 13){
						isRun = false;
					}
				}
			}
			var cal = new Date(ry, rm, 0);
			if(rd > cal.getDate())
				rd = cal.getDate();
			if (addDay != 0) {
				rd = rd + addDay;
				if(rd > cal.getDate() || rd < 1) {
					var isRun = true;
					while(isRun == true) {
						if(rd > cal.getDate()) {
							rd = rd - cal.getDate();
							rm++;
							if (rm > 12) {
								ry++;
								rm = 1;
							}
						}
						if(rd < 1) { 
							rm--;
							if(rm < 1) { 
								ry--;
								rm = 12;
							}
							cal = new Date(ry, rm, 0);
							rd = cal.getDate() + rd;
						}
						cal = new Date(ry, rm, 0);
						if(rd <= cal.getDate() && rd >= 1)
							isRun = false;
					}
				}
				if(rd > cal.getDate() || rd < 1) {
					cal = new Date(ry, rm, 0);
				}
			}
				
			if(rm.toString().length < 2) rm = '0' + rm;
			if(rd.toString().length < 2) rd = '0' + rd;
			
			return ry + token + rm + token + rd;
		};
	}
</script>
</html>
